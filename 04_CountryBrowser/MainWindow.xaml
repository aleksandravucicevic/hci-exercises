<Window
    x:Class="_04_CountryBrowser.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:_04_CountryBrowser.Converters"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:vm="clr-namespace:_04_CountryBrowser.ViewModels"
    Title="Country Browser"
    Width="900"
    Height="700"
    MinWidth="600"
    MinHeight="500"
    WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
        <converters:NullToEmptyStringConverter x:Key="NullConverter" />
    </Window.Resources>
    <Window.DataContext>
        <vm:CountrySearchViewModel />
    </Window.DataContext>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <!--  HEADER  -->
        <materialDesign:ColorZone
            Grid.Row="0"
            Padding="{StaticResource CardPaddingThickness}"
            materialDesign:ElevationAssist.Elevation="Dp4"
            Mode="PrimaryMid">
            <StackPanel Orientation="Horizontal">
                <materialDesign:PackIcon
                    Width="{StaticResource IconSizeExtraLarge}"
                    Height="{StaticResource IconSizeExtraLarge}"
                    Margin="{StaticResource IconMarginRight}"
                    VerticalAlignment="Center"
                    Kind="Earth" />
                <TextBlock
                    VerticalAlignment="Center"
                    FontSize="24"
                    FontWeight="Bold"
                    Text="Country Browser" />
            </StackPanel>
        </materialDesign:ColorZone>
        <!--  CONTENT  -->
        <ScrollViewer
            Grid.Row="1"
            HorizontalScrollBarVisibility="Disabled"
            VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="{StaticResource CardPaddingThickness}">
                <!--  SEARCH CARD  -->
                <materialDesign:Card Margin="{StaticResource CardMargin}" Padding="{StaticResource CardPaddingThickness}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" MinWidth="200" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <!--  TextBox sa Enter key binding  -->
                        <TextBox
                            Grid.Column="0"
                            Margin="{StaticResource StandardMargin}"
                            VerticalAlignment="Center"
                            materialDesign:HintAssist.Hint="Enter country name (e.g., Germany, Bosnia)"
                            FontSize="16"
                            Style="{StaticResource MaterialDesignFilledTextBox}"
                            Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}">
                            <TextBox.InputBindings>
                                <KeyBinding Key="Enter" Command="{Binding SearchCommand}" />
                            </TextBox.InputBindings>
                        </TextBox>
                        <!--  Vidljiv Button  -->
                        <Button
                            Grid.Column="1"
                            Height="{StaticResource StandardButtonHeight}"
                            MinWidth="{StaticResource MinButtonWidth}"
                            Background="{StaticResource MaterialDesignShadowBrush}"
                            Command="{Binding SearchCommand}"
                            Foreground="White"
                            Style="{StaticResource MaterialDesignRaisedButton}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon
                                    Width="{StaticResource IconSizeMedium}"
                                    Height="{StaticResource IconSizeMedium}"
                                    Margin="{StaticResource IconMarginRight}"
                                    VerticalAlignment="Center"
                                    Kind="Magnify" />
                                <TextBlock VerticalAlignment="Center" Text="SEARCH" />
                            </StackPanel>
                        </Button>
                    </Grid>
                </materialDesign:Card>
                <!--  STATUS CARD  -->
                <materialDesign:Card Margin="{StaticResource CardMargin}" Padding="{StaticResource StandardPaddingThickness}">
                    <materialDesign:Card.Style>
                        <Style TargetType="materialDesign:Card">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding StatusMessage, Converter={StaticResource NullConverter}}" Value="True">
                                    <Setter Property="Visibility" Value="Visible" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </materialDesign:Card.Style>
                    <StackPanel Orientation="Horizontal">
                        <!--  Loading - ISPRAVLJEN STYLE  -->
                        <ProgressBar
                            Width="{StaticResource IconSizeLarge}"
                            Height="{StaticResource IconSizeLarge}"
                            Margin="{StaticResource StandardMargin}"
                            VerticalAlignment="Center"
                            IsIndeterminate="True"
                            Style="{StaticResource MaterialDesignCircularProgressBar}"
                            Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}" />
                        <!--  Info Icon  -->
                        <materialDesign:PackIcon
                            Width="{StaticResource IconSizeLarge}"
                            Height="{StaticResource IconSizeLarge}"
                            Margin="{StaticResource StandardMargin}"
                            VerticalAlignment="Center"
                            Kind="InformationOutline">
                            <materialDesign:PackIcon.Style>
                                <Style TargetType="materialDesign:PackIcon">
                                    <Setter Property="Visibility" Value="Visible" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsLoading}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </materialDesign:PackIcon.Style>
                        </materialDesign:PackIcon>
                        <!--  Status Text  -->
                        <TextBlock
                            VerticalAlignment="Center"
                            Text="{Binding StatusMessage}"
                            TextWrapping="Wrap" />
                    </StackPanel>
                </materialDesign:Card>
                <!--  RESULTS  -->
                <ItemsControl ItemsSource="{Binding Countries}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <materialDesign:Card Margin="{StaticResource CardMargin}">
                                <Grid MinHeight="100">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <!--  FLAG  -->
                                    <Border Grid.Column="0" Background="#F0F0F0">
                                        <Image Source="{Binding FlagUrl, Mode=OneWay}" Stretch="UniformToFill" />
                                    </Border>
                                    <!--  INFO  -->
                                    <StackPanel
                                        Grid.Column="1"
                                        Margin="{StaticResource CardPaddingThickness}"
                                        VerticalAlignment="Center">
                                        <TextBlock
                                            FontSize="20"
                                            FontWeight="SemiBold"
                                            Text="{Binding DisplayName, Mode=OneWay}"
                                            TextWrapping="Wrap" />
                                        <StackPanel Margin="0,8,0,0" Orientation="Horizontal">
                                            <materialDesign:PackIcon
                                                Width="{StaticResource IconSizeMedium}"
                                                Height="{StaticResource IconSizeMedium}"
                                                Margin="{StaticResource IconMarginRight}"
                                                VerticalAlignment="Center"
                                                Kind="City" />
                                            <TextBlock TextWrapping="Wrap">
                                                <Run Text="Capital:" />
                                                <Run FontWeight="Medium" Text="{Binding CapitalCity, Mode=OneWay}" /></TextBlock>
                                        </StackPanel>
                                        <StackPanel Margin="0,5,0,0" Orientation="Horizontal">
                                            <materialDesign:PackIcon
                                                Width="{StaticResource IconSizeMedium}"
                                                Height="{StaticResource IconSizeMedium}"
                                                Margin="{StaticResource IconMarginRight}"
                                                VerticalAlignment="Center"
                                                Kind="AccountGroup" />
                                            <TextBlock TextWrapping="Wrap">
                                                <Run Text="Population:" />
                                                <Run FontWeight="Medium" Text="{Binding PopulationText, Mode=OneWay}" /></TextBlock>
                                        </StackPanel>
                                    </StackPanel>
                                </Grid>
                            </materialDesign:Card>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                <!--  EMPTY STATE  -->
                <StackPanel
                    Margin="0,50,0,0"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Countries.Count}" Value="0" />
                                        <Condition Binding="{Binding IsLoading}" Value="False" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                </MultiDataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>
                    <materialDesign:PackIcon
                        Width="80"
                        Height="80"
                        HorizontalAlignment="Center"
                        Kind="EarthOff"
                        Opacity="0.3" />
                    <TextBlock
                        Margin="{StaticResource CardPaddingThickness}"
                        HorizontalAlignment="Center"
                        FontSize="20"
                        Text="No countries found" />
                    <TextBlock
                        MaxWidth="300"
                        HorizontalAlignment="Center"
                        FontSize="14"
                        Text="Try searching for a different country name"
                        TextAlignment="Center"
                        TextWrapping="Wrap" />
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Window>